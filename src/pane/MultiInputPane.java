package pane;

import java.awt.Color;
import java.awt.Font;

import javax.swing.*;

/*
 * Essa classe é utilizada para receber múltiplas informações do usuário
 */

public class MultiInputPane extends Pane {

	//Variáveis internas
	private static SmartField[] edits;
	
	// Construtor
	public MultiInputPane(String titulo, String texto, Object[][] inputs, int width) {
	
		// Construtor do pane
		super(titulo, texto, width);

		// Re-setando variável width
		width = getBounds().width;

		// Iniciando array
		edits = new SmartField[inputs.length];

		//Adicionando edits à janela
		for (int i = 0; i < inputs.length; i++) {

			//Obtendo caracteres permitidos
			String caracteresPermitidos = "";
			
			//Obtendo mínimo e máximo para o TextField
			double min = Pane.DOUBLE_MIN, max = Pane.DOUBLE_MAX;
			
			switch (inputs[i][1].toString().toUpperCase()) {
			
				case "INT": {
					
					//Verificando se foi passado mínimo e máximo para esse edit
					if (inputs[i].length > 2) {
						
						//Atribuindo valores
						min = (double) (Integer) inputs[i][2];
						max = (double) (Integer) inputs[i][3];
						
						//Iniciando edit com valores personalizados
						edits[i] = new SmartField(false, min, max);
					} else {
					
						//Iniciando edit padrão
						edits[i] = new SmartField(false);
					}
					break;
				}
				
				case "DOUBLE": {
					
					//Verificando se foi passado mínimo e máximo para esse edit
					if (inputs[i].length > 2) {
						
						//Atribuindo valores
						min = (double) (Integer) inputs[i][2];
						max = (double) (Integer) inputs[i][3];
						
						//Iniciando edit com limites personalizados
						edits[i] = new SmartField(true, min, max);
					} else {
						
						//Iniciando edit padrão
						edits[i] = new SmartField(true);
					}
					break;
				}
				
				case "STRING": {
					
					//Verificando se foi passado uma parâmetro extra
					if (inputs[i].length > 2) {
						
						//Iniciando edit com caracteres permitidos personalizados
						edits[i] = new SmartField(inputs[i][0].toString(), inputs[i][2].toString());
					} else {
						
						//Inciando edit padrão
						edits[i] = new SmartField(inputs[i][0].toString());
					}
				}
			}
			SmartField edit = edits[i];

			//Configurando posição do texto
			edit.setHorizontalAlignment(SwingConstants.CENTER);
			
			//Arrumando posição e tamanho do edit
			edit.setBounds(50, 35 * (i + 1) + lblHeight, width - 100, 25);

			//Adicionando edit à janela
			add(edit);
		}

		//Adicionando botão para finalizar
		add(new FinishButton(this, width, 35 * (inputs.length + 1) + lblHeight));
		
		//Arrumando tamanho da tela (75 seria o tamanho do botão mais 50 de margem)
		setBounds(0, 0, width,  35 * (inputs.length + 1) + lblHeight + 75);

		// Seta para a janela aparecer no meio da tela
		setLocationRelativeTo(null);

		// Deixa a janela visível
		setVisible(true);
	}
	
	public void desenharPlaceholders() {
		
		for (SmartField edit : edits) {
			edit.desenharPlaceholder();
		}
	}
	
	public static Object[] input(String titulo, String texto, Object[][]inputs, int width) {
		
		//Vetor que será retornado
		Object[] vetor = new Object[inputs.length];

		//Cria uma janela de acordo com as configurações específicadas
		MultiInputPane pane = new MultiInputPane(titulo, texto, inputs, width);
		
		//Eperando janela renderizar
		try {
			Thread.sleep(100);
		} catch(Exception e) {}
		
		//Desenhando placeholders
		pane.desenharPlaceholders();
		
		//Laço para verificar se nenhum edit ficou vazio
		boolean algoVazio = true;
		while (algoVazio) {
			
			algoVazio = false;
			pane.setVisible(true);
			pane.setEstado(0);
			
			//Espera o usuário terminar de inserir suas informações
			esperaTerminar(pane);
			
			//Coleta as informações inseridas
			for (int i = 0; i < vetor.length; i++) {
				
				//Variável que recebe a informação no edit
				String text = edits[i].getText();
				
				//Reseta cores do edit
				edits[i].setBorder(BorderFactory.createLineBorder(Color.GRAY));
				edits[i].setBackground(Color.WHITE);
				edits[i].setForeground(Color.BLACK);
				
				//Verifica se o campo está vazio
				if (text.isEmpty()) {
					
					//Define a cor da borda como vermelho
					edits[i].setBorder(BorderFactory.createLineBorder(Color.RED));
					
					//Define a cor do fundo como vermelho
					edits[i].setBackground(Color.decode("#ffb3b3"));
					
					//Define a cor do texto como vermelho
					edits[i].setForeground(Color.RED);
					
					algoVazio = true;
				}
				
				//Verificando se é necessário converter
				switch (inputs[i][1].toString().toUpperCase()) {
				
					//Caso não precise apenas seta a variável como string
					case "STRING":
						vetor[i] = text;
						break;
					
					//Converte para integer caso necessário
					case "INT":
						vetor[i] = Integer.parseInt(text);
						break;
					
					//Converte para double caso necessário
					case "DOUBLE":
						vetor[i] = Double.parseDouble(text);
						break;
				}
			}
		}
		
		//Retorna o vetor
		return vetor;
	}
}